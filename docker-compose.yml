version: "3.9"
services:

  server: 
    image: sanguino/eolo-planner-server
    ports:
    - 3000:3000
    environment:
    - RABBIT_USER=guest
    - RABBIT_PASS=guest
    - RABBIT_HOST=rabbitmq
    - RABBIT_PORT=5672
    - MYSQL_DBNAME=eoloplantsDB
    - MYSQL_HOST=mysql
    - MYSQL_PORT=3306
    - MYSQL_USER=root
    - MYSQL_PASS=password
    depends_on: 
    - mysql
    - rabbitmq
    command: ["./wait-for-it.sh", "-t", "120", "mysql:3306", "--", "./wait-for-it.sh", "-t", "120", "rabbitmq:5672", "--", "node", "src/server.js"]

  weatherservice: 
    image: sanguino/eolo-planner-weatherservice
    ports:
    - 9090:9090

  toposervice: 
    image: sanguino/eolo-planner-toposervice
    ports:
    - 8080:8080
    environment:
    - MONGO_HOST=localhost
    - MONGO_PORT=27017
    - MONGO_DB=topo
    depends_on:
    - mongo

  mongo:
    image: mongo:latest
    ports:
    - 27017-27019:27017-27019
    volumes:
    - ./data/mongo:/data/db

  mysql:
    image: mysql:8.0.22
    ports:
    - 3306:3306
    environment:
    - MYSQL_ROOT_PASSWORD=password
    - MYSQL_DATABASE=eoloplantsDB
    volumes:
    - ./data/mysql:/var/lib/mysql

  rabbitmq:
    image: rabbitmq:3-management
    ports:
    - 5672:5672
    - 15672:15672
    volumes:
    - ./data/rabbitmq:/var/lib/rabbitmq/mnesia/





